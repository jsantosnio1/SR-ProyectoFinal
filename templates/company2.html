{% extends 'layout.html' %}

{% block title %}{{company["nombre_empresa"]}}{% endblock %}

{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <title> Comprar </title>
</head>
<body>
    
    <script>
        function comprar(id_company){
            $.ajax({
				type: "POST",
				url: "/saveBuy",
				data: {
					'id_company': id_company
				},
				success: function(data) {
					console.log(data);
				},
				error: function(data) {
					console.log(data);
				},
			});
        }
    </script>
    <h1>{{company["nombre_empresa"]}}</h1>
    <div class="container-fluid">	
        <div class="row">
                 <div class="col-md-4">
                    <table class="summary-data__table" role="table">
                        <thead class="visually-hidden" role="rowgroup">
                          <tr role="row">
                            <th role="columnheader" scope="col">Label</th>
                            <th role="columnheader" scope="col">Value</th>
                          </tr>
                        </thead>
                        <tbody class="summary-data__table-body" role="rowgroup"><tr class="summary-data__row" role="row" data-first-five="true" data-first-ten="true">
                            <td role="cell" class="summary-data__cellheading">Exchange</td><td role="cell" class="summary-data__cell">{{company["exchange"]}}</td>
                          </tr><tr class="summary-data__row" role="row" data-first-five="true" data-first-ten="true">
                            <td role="cell" class="summary-data__cellheading">Sector</td><td role="cell" class="summary-data__cell">{{company["sector"]}}</td>
                          </tr><tr class="summary-data__row" role="row" data-first-five="true" data-first-ten="true">
                            <td role="cell" class="summary-data__cellheading">Industry</td><td role="cell" class="summary-data__cell">{{company["industry"]}}</td>
                          </tr><tr class="summary-data__row" role="row" data-first-five="true" data-first-ten="true">
                            <td role="cell" class="summary-data__cellheading">1 Year Target</td><td role="cell" class="summary-data__cell">{{company["year_target"]}}</td>
                          </tr><tr class="summary-data__row" role="row" data-first-five="true" data-first-ten="true">
                            <td role="cell" class="summary-data__cellheading">Today's High/Low</td><td role="cell" class="summary-data__cell">{{company["today"]}}</td>
                          </tr><tr class="summary-data__row" role="row" data-first-ten="true">
                            <td role="cell" class="summary-data__cellheading">Share Volume</td><td role="cell" class="summary-data__cell">{{company["share_volume"]}}</td>
                          </tr><tr class="summary-data__row" role="row" data-first-ten="true">
                            <td role="cell" class="summary-data__cellheading">Average Volume</td><td role="cell" class="summary-data__cell">{{company["average_volume"]}}</td>
                          </tr><tr class="summary-data__row" role="row" data-first-ten="true">
                            <td role="cell" class="summary-data__cellheading">Previous Close</td><td role="cell" class="summary-data__cell">{{company["previous_close"]}}</td>
                          </tr><tr class="summary-data__row" role="row" data-first-ten="true">
                            <td role="cell" class="summary-data__cellheading">52 Week High/Low</td><td role="cell" class="summary-data__cell">{{company["h_week"]}}</td>
                          </tr></tbody><tbody class="summary-data__table-body" role="rowgroup"><tr class="summary-data__row" role="row" data-first-ten="true">
                            <td role="cell" class="summary-data__cellheading">Market Cap</td><td role="cell" class="summary-data__cell">{{company["market_cap"]}}</td>
                          </tr><tr class="summary-data__row" role="row">
                            <td role="cell" class="summary-data__cellheading">P/E Ratio</td><td role="cell" class="summary-data__cell">{{company["ratio"]}}</td>
                          </tr><tr class="summary-data__row" role="row">
                            <td role="cell" class="summary-data__cellheading">Forward P/E 1 Yr.</td><td role="cell" class="summary-data__cell">{{company["forward"]}}</td>
                          </tr><tr class="summary-data__row" role="row">
                            <td role="cell" class="summary-data__cellheading">Earnings Per Share(EPS)</td><td role="cell" class="summary-data__cell">{{company["earnings"]}}</td>
                          </tr><tr class="summary-data__row" role="row">
                            <td role="cell" class="summary-data__cellheading">Annualized Dividend</td><td role="cell" class="summary-data__cell">{{company["annualized_dividend"]}}</td>
                          </tr><tr class="summary-data__row" role="row">
                            <td role="cell" class="summary-data__cellheading">Ex Dividend Date</td><td role="cell" class="summary-data__cell">{{company["dividen_date"]}}</td>
                          </tr><tr class="summary-data__row" role="row">
                            <td role="cell" class="summary-data__cellheading">Dividend Pay Date</td><td role="cell" class="summary-data__cell">{{company["dividen_pay"]}}</td>
                          </tr><tr class="summary-data__row" role="row">
                            <td role="cell" class="summary-data__cellheading">Current Yield</td><td role="cell" class="summary-data__cell">{{company["current_yield"]}}</td>
                          </tr>
                          {% if company["beta"] %}
                          <tr class="summary-data__row" role="row">
                            <td role="cell" class="summary-data__cellheading">Beta</td><td role="cell" class="summary-data__cell">{{company["beta"]}}</td>
                          </tr>
                          {% endif %}
                          </tbody>
                      </table>
              </div>
            
              <div class="col-md-8">
                <div class="chartCard">
                    <div class="chartBox">
                      <canvas id="myChart"></canvas>
                      <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.1.1/d3.min.js" integrity="sha512-COTaPOlz12cG4fSfcBsxZsjauBAyldqp+8FQUM/dZHm+ts/jR4AFoJhCqxy8K10Jrf3pojfsbq7fAPTb1XaVkg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
                      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                      <script>
                          let filename = '/getPlotCSV/{{company["name_file"]}}';
                          d3.csv(filename).then(function(loadedData){
                            //console.log(loadedData);
                            let data = [];
                            let labels = [];
                
                            for (let i = 0; i < loadedData.length; i++) {
                                   console.log(loadedData[i]);
                
                                   let Datea = loadedData[i].Date;
                                   labels.push(Datea);
                                   let Close = loadedData[i].Close;
                                   data.push(Close);
                            }
                
                            let options = {
                                type: 'line',
                                data:{
                                    labels: labels,
                                    datasets: [
                                        {
                                            data: data,
                                            fill: false,
                                            pointRadius: 0,
                                            pointHoverRadius: 0,
                                            borderColor: 'rgb(100,100,100)'
                                        }
                                    ]
                
                                },
                                options: {
                                  
                                    plugins: {
                                        title: {
                                            display: true,
                                            text: 'Valor acciones por fecha'
                                        },
                                        legend: {
                                            display: false,
                                            
                                        }
                                    }
                                }
                            };
                
                            const myChart = new Chart(document.getElementById('myChart'), options);
                
                          });
                
                
                      </script>
                    </div>
                  </div>
            

              </div>
            
        </div>
    </div>
    <center>
    <button type="submit" class="boton_personalizado" onclick="comprar({{company['id_empresa']}})">Comprar</button>
</center>
</body>
</html>
{% endblock %}